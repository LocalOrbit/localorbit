module PackingLabels
  class Generator
    class << self
      def generate(orders:,request:,product_labels_only:,product_label_format:,print_multiple_labels_per_item:)
        order_infos = PackingLabels::OrderInfo.make_order_infos(orders:orders, host: request.base_url)
        # [ 
        #   { order_number: .... }
        #   { order_number: .... }
        #   { order_number: .... }
        # ]
        labels = PackingLabels::Label.make_labels(order_infos, product_labels_only, product_label_format, print_multiple_labels_per_item)
        # [
        #   { template: "...", data: { ... } }
        #   { template: "...", data: { ... } }
        # ]

        pages = PackingLabels::Page.make_pages(labels, product_label_format)
          # [
          #   {a: {label} b: {label} ... }
          #   {a: {label} b: {label} ... }
          #   {a: {label} b: {label} ... }
          # ]

        if product_label_format == 1
          label_template = 'avery_labels/labels_1'
        elsif product_label_format == 4
          label_template = 'avery_labels/labels_4'
        elsif product_label_format == 16
          label_template = 'avery_labels/labels_16'
        end

        if product_label_format > 1
          TemplatedPdfGenerator.generate_pdf(
            request: request,
            template: label_template,
            pdf_settings: TemplatedPdfGenerator::ZeroMargins.merge(page_size: "letter"),
            locals: {
              params: {
                pages: pages
              }
            }
          )
        else # generate ZPL for 1-up label
          a = Array.new
          pages.each do |page|
            order_url = Rails.application.routes.url_helpers.qr_code_url(host: request.base_url, id: page[:a][:data][:order][:id])
            a << ["^XA^FX^CF0,70^FO50,50^FD#{page[:a][:data][:product][:product_name]}^FS^CF0,55^FO50,105^FD#{page[:a][:data][:product][:product_code]}^FS^FO50,155^FD#{page[:a][:data][:product][:unit_desc]}, #{page[:a][:data][:product][:lot_desc]}^FS^FO50,200^FD#{page[:a][:data][:product][:producer_name]}^FS^FX^CF0,30^FO50,280^FDDeliver On:^FS^CF0,50^FO50,305^FD#{page[:a][:data][:order][:deliver_on]}^FS^CF0,30^FO50,375^FDOrder #:^FS^CF0,50^FO50,400^FD#{page[:a][:data][:order][:order_number]}^FS^CF0,30^FO50,470^FDBuyer:^FS^CF0,50^FO50,495^FD#{page[:a][:data][:order][:buyer_name]}^FS^FO50,250^GB500,1,3^FS^FX^FO400,770^BXN,7,200^FD#{order_url}^FS^FO50,750^GFA,5000,5000,25,,:gH07JFE,g03NFC,Y07PFC,X07RFC,W03TFC,V01VF8,V0WFE,U03XFC,T01gF,T07gFC,S01gHF,S07gHFC,R01gJF,R03gJFC,R0gKFE,Q03gLF8,Q07gLFC,Q0gNF,P03gNF8,P07gNFE,O01gPF,O03gPF8,O07gPFC,O0gRF,N01gRF8,N07gRFC,N0gSFE,M01gTF,M03gTF8,M07gTFC,M0gUFE,L01gVF,L01gVF8,L03gVFC,L07gVFE,L0gWFE,K01OFE07FFE0FFEFBEF80E03C3NF,K03LFCF9C03E7C033CFBE70060380NF8,K03LFCF9CFFC7CF1BC73C7F7EFF9E7MFC,K07LFCF9CFFC7CF99C73C7F7EFF9F7MFE,K0MFCF9CFF93CF99C7393F7EFF9F7MFE,J01MFCF9CFF9BCFI97793F7EFF9E7NF,J01MFC01C07B9CF9D927BBF7E0780OF8,J03MFCF9CFF39CF9CB2739F7E7F81OF8,J07MFCF9CFF39CF9C3A739F7EFF9DOFC,J07MFCF9CFF00CF9C38F00F7EFF9COFE,J0NFCF9CFE7CCF9E78E7CF7EFF9E7NFE,I01NFCF9C067EC03E7CE7EF7E039E7OF,I01NFCF9C02FEE07E7DEFEF7E03BF7OF8,I03hHF8,I03hHFC,I07hHFC,I07hHFE,I0hIFE,I0hJF,001hJF,001WF00KF01XF8,003OFCJ03FC003IF8003FFJ0QF8,003OFCJ01FJ0IFI01FFJ03PFC,007OFCJ01EJ07FEJ07FJ01PFC,007OFCJ01EJ03FCJ03FK0PFE,00PFCJ01CJ01F8J03FK07OFE,00PFCJ018I021F8I021FK03OFE,00PFCJ018J01F8J01FK03PF,01PFC00807803C00F003C41F006001PF,01PFC01IF803E00F007E01F00FC01PF8,01PFC01IF807E00F007E01F00FC01PF8,03PFC01IF807F00F007E01F00FE01PF8,03PFC01IF007E00F007E00F00FE01PFC,03PFC01IF807E00F007E01F00FE01PFC,07PFC01IF807E00F007E00F00FE01PFC,:07PFC01IF807F00F007E00F00FE01PFE,0QFC01IF007F00F007E00F00FE01PFE,0QFC01IF807E00F007E00F00FE01PFE,0QFCI07F807E00F007E00F00FE01PFE,0QFCJ0F007E00F007E00F00FE01QF,1QFCJ0F007E00F007E00F00FE01QF,1QFCJ0F007F00F007E00F00FE01QF,1QFCJ0F807E00F007E00F00FE01QF,1QFCJ0F807F00F007E01F00FE01QF81QFCJ0F807F00F007E00F00FE01QF81QFCI01F007F00F007E00F00FE01QF83QFC01IF007E00F007E00F00FE01QF83QFC01IF007F00F007E00F00FE01QF83QFC01IF807E00F007E00F00FE01QF8:3QFC01IF007E00F007E00F00FE01QFC::::7QFC01IF007E00F007E00F00FC01QFC7QFC01IF807E00F007E00F00FC01QFC7QFC01IF803E00F003C01F00F801QFC7QFC01IF8K0FK01FK01QFC7QFC01IF8J01F8J01FK03QFC7QFC01IFCJ01F8J03FK03QFC7QFC01IFCJ03FCJ03FK07QFC7QFC01IFEJ07FEJ07FK0RFC7QFC01JFJ0IFJ0FFJ01RFC7QFC01JF8001IF8001FFJ03RFC7QFE03JFE007IFE007FFI01SFC7hNFC:3hNFC:::3RF007FE00FF007FC01FEJ03SF83QFE003FC00FE003F800FEK0SF83QFE003FC00FE003F800FCK03RF83QFE003FC00FE003F800FCK01RF83QFE003FC00FE003FC00FCL0RF81QFE003FC00FE003F800FCL07QF81QFE003FC00FE003F800FEL07QF81QFE003FC00FE003F800FCL03QF,:1QFE003FC00FE003F800FC0078003QF,0QFE003FC00FE003F800FC007E003QF,:0QFE003FC00FE003F800FC007F003PFE,0QFE003FC00FE003F800FC007F001PFE,07PFE003FC00FE003F800FC007F001PFE,07PFE007FC00FE003F800FC007F001PFE,07PFE003FC00FE003F800FC007F001PFC,07PFE003FC00FE003F800FE007F001PFC,03PFE003FC00FE003F800FC007F001PFC,03PFE003FC00FE003F800FC007F001PF8,03PFE003FC00FE003FC00FC007F003PF8,01PFE003FC00FE003FC00FC007E003PF8,01PFE003FC00FE003F800FC007E003PF,01PFEI04I0FE003F800FCL07PF,00PFEM0FE003F800FCL07PF,00PFEM0FE003F800FCL0PFE,007OFEM0FE003F800FCK01PFE,007OFEM0FE003F800FEK03PFC,007OFEM0FE003F800FEL0PFC,003OFEM0FE003FC00FCL0PFC,003OFEM0FE003F800FCL07OF8,001OFEM0FE003F800FCL03OF8,001OFEM0FE003F800FC007C003OF,I0OFE003FC00FE003F800FC007F001OF,I0OFE003FC00FE003F800FC007F001NFE,I07NFE003FC00FE003F800FC007F001NFE,I07NFE003FC00FE003F800FC007F801NFC,I03NFE003FC00FE003F800FC007F801NFC,I03NFE003FC00FE003F800FE007F801NF8,I01NFE003FC00FE003F800FC007F801NF,J0NFE003FC00FE003F800FC007F801NF,J0NFE003FC00FE003F800FC007F801MFE,J07MFE003FC00FE003F800FC007F801MFE,J03MFE003FC00FE003F800FC007F801MFC,J03MFE003FC00FE003F800FC007F001MF8,J01MFE003FC00FE003F800FE007F001MF,K0MFE003FC00FE003F800FE007E001MF,K0MFE003FC00FE001F001FC002I01LFE,K07LFE003FC00FFL01FCL03LFC,K03LFE003FC00FFL01FCL03LFC,K01LFE003FC00FF8K03FCL03LF8,K01LFE003FC00FF8K03FCL07LF,L0LFE003FC00FFCK07FCL0LFE,L07KFE003FC00FFEK0FFCK01LFC,L03KFE003FC00IFJ01FFCK03LF8,L01KFE007FC00IF8I03FFEK0MF8,M0LF00FFE81IFE001JFI01NF,M07VFE1VFE,M03gTFC,M01gTF8,N0gTF,N07gRFE,N03gRF8,N01gRF,O0gQFE,O07gPFC,O01gPF8,P0gOFE,P07gNFC,P01gNF8,Q0gMFE,Q03gLFC,Q01gLF,R07gJFE,R03gJF8,S0gIFE,S03gHF8,T0gGFE,T03gF8,U0YFE,U01XF8,V07VFC,W0UFE,W01TF,X01RF8,Y01PF8,gG0MFE,gI07FFC,,^FS^XZ"]
          end
          a
        end
      end
    end
  end
end