<div class="tab-header stickable">
  <div class="l-constraint">
    <%= link_to "#{svg_icon} Export CSV".html_safe, coming_soon_dashboard_path, class: "export todo pull-right" %>
    <h1><i class="font-icon" data-icon="&#xe01f;"></i>&nbsp; Products</h1>

    <div class="row row--justified product-header">
      <div class="column">
        <% if current_user.multi_market_membership? %>
          <%= select_tag :filter_market, options_for_select(@selling_markets, selected: params[:market]), class: 'filter-dropdown', data: { parameter: "market"} %>
        <% end %>
        <% if current_user.multi_organization_membership? %>
          <%= select_tag :filter_organization, options_for_select(@selling_organizations, selected: params[:organization]), class: 'filter-dropdown', data: { parameter: "organization"} %>
        <% end %>
      </div>

      <div class="column">
        <input type="search" id="search" value="<%= params[:search] %>"><button type="submit" id="search-btn" class="btn btn--end">Search</button>
        <%= link_to "Add New Product", new_admin_product_path, class: "btn btn--add btn--small" %>
      </div>
    </div>
  </div>
</div>

<table class="product-table product-table--admin sortable">
  <thead class="stickable">
    <tr>
      <%= content_tag(:th, 'Seller', data: {column: 'seller'}, class: column_sort_classes("seller")) if current_user.multi_organization_membership? %>
      <%= content_tag(:th, 'Market', data: {column: 'market'}, class: column_sort_classes("market")) if current_user.multi_market_membership? %>
      <th data-column="name" class="<%= column_sort_classes("name") %>">Name</th>
      <th data-column="price:desc" class="<%= column_sort_classes("price") %>">Pricing</th>
      <th data-column="stock:desc" class="<%= column_sort_classes("stock") %>">InÂ Stock</th>
      <th></th>
    </tr>
  </thead>
  <% @products.each do |product| %>
    <tr class="product-row <%= cycle "odd", "even" %>">
      <%= content_tag(:td, link_to(product.organization_name, [:admin, product.organization]), class: 'seller') if current_user.multi_organization_membership? %>
      <%= content_tag(:td, link_to(product.market_name, [:admin, product.organization.markets.first]), class: 'market') if current_user.multi_market_membership? %>
      <td class="name product-name"><%= link_to product.name, [:admin, product] %></td>
      <td class="pricing">
        <ul class="l-inline-list">
          <% product.prices.view_sorted.decorate.each do |price| %>
          <%= content_tag(:li, link_to(price.quick_info, [:admin, product, :prices], class: 'edit-toggle')) %>
          <% end %>
        </ul>
      </td>
      <td class="stock">
        <%= link_to product.available_inventory, [:admin, product, :lots], class: "edit-toggle" %>
      </td>
      <td class="delete action-link"><%= link_to raw('<i class="font-icon icon-delete"></i> Delete'), [:admin, product], method: :delete, data: { confirm: "Are you sure you want to delete this product?" } %></td>
    </tr>
  <% end %>
</table>

<%= paginate @products %>

<% if @products.none? %>
  <div class="empty-results">
    <h2>No Results</h2>
    This table is empty, either because there is no data, or because the filter you've applied is hiding it.
  </div>
<% end %>
