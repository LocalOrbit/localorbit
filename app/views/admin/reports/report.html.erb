<%= render "admin/reports/header" %>
<%= render "admin/reports/filters", presenter: @presenter %>

<div class="">
  <table class="sortable sold-table">
    <thead class="stickable">
      <tr>
        <% @presenter.fields.each do |field| %>
          <% filter_map = ReportsPresenter::FIELD_MAP[field] || {} %>
          <th><%= sort_link @presenter.q, filter_map[:sort], filter_map[:display_name] %></th>
        <% end %>
      </tr>
    </thead>

    <% @presenter.items.decorate.each do |item| %>
    <tr class="<%= cycle "odd", "even" %> sold-item">
      <% @presenter.fields.each do |field| %>
        <% if field == :placed_on %>
          <td class="order-number">
            <%= content_tag "span", item.placed_on, class: "placed-at" %><br>
            <%= link_to item.order_number, admin_order_path(item.order), class: "order-number-bold" %>
          </td>
        <% end %>

        <% if field == :category_name %>
          <td class="category-name"><%= item.category_name %></td>
        <% end %>

        <% if field == :product_name %>
          <td class="order-product"><%= link_to item.product_name, [:admin, item.product], class: "product" %></td>
        <% end %>

        <% if field == :seller_name %>
          <td class="order-seller"><%= link_to item.seller_name, [:admin, item.product.organization], class: "seller" %></td>
        <% end %>

        <% if field == :buyer_name %>
          <td>
            <%= link_to item.buyer_name, [:admin, item.order.organization], class: "buyer" %><br>
            <%= content_tag "span", item.market_name, class: "market" %>
          </td>
        <% end %>

        <% if field == :quantity %>
          <td class="quantity"><%= item.quantity %></td>
        <% end %>

        <% if field == :unit_price %>
          <td class="row-total"><%= item.unit_price %></td>
        <% end %>

        <% if field == :discount %>
          <td class="discount"><%= item.discount %></td>
        <% end %>

        <% if field == :row_total %>
          <td class="row-total"><%= item.row_total %></td>
        <% end %>

        <% if field == :net_sale %>
          <td class="order-net-sale">
            <%= content_tag "span", item.net_sale, class: "total-price" %><br>
            <%= content_tag "span", item.price_per_unit, class: "unit-price" %>
          </td>
        <% end %>

        <% if field == :delivery_status %>
          <td class="delivery-status"><%= item.delivery_status %></td>
        <% end %>

        <% if field == :buyer_payment_status %>
          <td class="buyer-payment-status"><%= item.buyer_payment_status %></td>
        <% end %>

        <% if field == :seller_payment_status %>
          <td class="seller-payment-status"><%= item.seller_payment_status %></td>
        <% end %>
      <% end %>
    </tr>
    <% end %>
  </table>
</div>

<%= render "admin/reports/footer", presenter: @presenter %>
